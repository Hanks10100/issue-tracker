{
  "url": "https://api.github.com/repos/alibaba/weex/issues/1273",
  "repository_url": "https://api.github.com/repos/alibaba/weex",
  "labels_url": "https://api.github.com/repos/alibaba/weex/issues/1273/labels{/name}",
  "comments_url": "https://api.github.com/repos/alibaba/weex/issues/1273/comments",
  "events_url": "https://api.github.com/repos/alibaba/weex/issues/1273/events",
  "html_url": "https://github.com/alibaba/weex/issues/1273",
  "id": 178287625,
  "number": 1273,
  "title": "[ios] stream 模块的并发问题",
  "user": {
    "login": "lmnsg",
    "id": 10400425,
    "avatar_url": "https://avatars2.githubusercontent.com/u/10400425?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lmnsg",
    "html_url": "https://github.com/lmnsg",
    "followers_url": "https://api.github.com/users/lmnsg/followers",
    "following_url": "https://api.github.com/users/lmnsg/following{/other_user}",
    "gists_url": "https://api.github.com/users/lmnsg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lmnsg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lmnsg/subscriptions",
    "organizations_url": "https://api.github.com/users/lmnsg/orgs",
    "repos_url": "https://api.github.com/users/lmnsg/repos",
    "events_url": "https://api.github.com/users/lmnsg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lmnsg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": [
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248565975",
      "html_url": "https://github.com/alibaba/weex/issues/1273#issuecomment-248565975",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1273",
      "id": 248565975,
      "user": {
        "login": "acton393",
        "id": 11631084,
        "avatar_url": "https://avatars1.githubusercontent.com/u/11631084?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/acton393",
        "html_url": "https://github.com/acton393",
        "followers_url": "https://api.github.com/users/acton393/followers",
        "following_url": "https://api.github.com/users/acton393/following{/other_user}",
        "gists_url": "https://api.github.com/users/acton393/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/acton393/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/acton393/subscriptions",
        "organizations_url": "https://api.github.com/users/acton393/orgs",
        "repos_url": "https://api.github.com/users/acton393/repos",
        "events_url": "https://api.github.com/users/acton393/events{/privacy}",
        "received_events_url": "https://api.github.com/users/acton393/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-21T09:59:14Z",
      "updated_at": "2016-09-21T09:59:14Z",
      "body": "程序会卡主是什么情况，不能接受点击事件了么，你用的是xcode8 对吧\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248580405",
      "html_url": "https://github.com/alibaba/weex/issues/1273#issuecomment-248580405",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1273",
      "id": 248580405,
      "user": {
        "login": "lmnsg",
        "id": 10400425,
        "avatar_url": "https://avatars2.githubusercontent.com/u/10400425?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/lmnsg",
        "html_url": "https://github.com/lmnsg",
        "followers_url": "https://api.github.com/users/lmnsg/followers",
        "following_url": "https://api.github.com/users/lmnsg/following{/other_user}",
        "gists_url": "https://api.github.com/users/lmnsg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/lmnsg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lmnsg/subscriptions",
        "organizations_url": "https://api.github.com/users/lmnsg/orgs",
        "repos_url": "https://api.github.com/users/lmnsg/repos",
        "events_url": "https://api.github.com/users/lmnsg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/lmnsg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-21T11:09:01Z",
      "updated_at": "2016-09-21T11:09:01Z",
      "body": "@acton393 对的，xcode8 ，只是单纯这个 fetch 行为卡住了，等待时间非常久才会发出请求，经过多次测试确定不是服务端的问题。\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248585849",
      "html_url": "https://github.com/alibaba/weex/issues/1273#issuecomment-248585849",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1273",
      "id": 248585849,
      "user": {
        "login": "cxfeng1",
        "id": 1625893,
        "avatar_url": "https://avatars2.githubusercontent.com/u/1625893?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/cxfeng1",
        "html_url": "https://github.com/cxfeng1",
        "followers_url": "https://api.github.com/users/cxfeng1/followers",
        "following_url": "https://api.github.com/users/cxfeng1/following{/other_user}",
        "gists_url": "https://api.github.com/users/cxfeng1/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/cxfeng1/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cxfeng1/subscriptions",
        "organizations_url": "https://api.github.com/users/cxfeng1/orgs",
        "repos_url": "https://api.github.com/users/cxfeng1/repos",
        "events_url": "https://api.github.com/users/cxfeng1/events{/privacy}",
        "received_events_url": "https://api.github.com/users/cxfeng1/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-21T11:37:05Z",
      "updated_at": "2016-09-21T11:37:05Z",
      "body": "@lmnsg 麻烦给一个demo， 多次并发在[stream-demo](https://github.com/alibaba/weex/blob/dev/examples/module/stream-demo.we)里是没问题的。\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248792236",
      "html_url": "https://github.com/alibaba/weex/issues/1273#issuecomment-248792236",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1273",
      "id": 248792236,
      "user": {
        "login": "lmnsg",
        "id": 10400425,
        "avatar_url": "https://avatars2.githubusercontent.com/u/10400425?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/lmnsg",
        "html_url": "https://github.com/lmnsg",
        "followers_url": "https://api.github.com/users/lmnsg/followers",
        "following_url": "https://api.github.com/users/lmnsg/following{/other_user}",
        "gists_url": "https://api.github.com/users/lmnsg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/lmnsg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lmnsg/subscriptions",
        "organizations_url": "https://api.github.com/users/lmnsg/orgs",
        "repos_url": "https://api.github.com/users/lmnsg/repos",
        "events_url": "https://api.github.com/users/lmnsg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/lmnsg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-22T01:58:01Z",
      "updated_at": "2016-09-22T01:58:01Z",
      "body": "@cxfeng1  sorry, demo 我不知道怎么弄\n我粘一下我的代码，你帮我大概看一下把...\n问题出在 onrfresh 的时候触发 onrfresh 函数内的操作时有80%的几率卡住。\n我通过多次断点，发现程序是卡在 stream.fetch 的位置，\nps: 里面有使用 async.series.  有可能是因为这个么？\n\n``` html\n<script>\n    import {fetch, storage, navTo, createUrl, toast, modal} from '../libs/util'\n    import series from 'async/series'\n\n    const topBg = '#fa642f'\n    const bottomBg = '#f5f5f5'\n\n    export default {\n        data: {\n            loading: 'hide',\n            bodyBg: '',\n            icons: {},\n            pages: {},\n            hasMsg: false,\n            user: {},\n            fp: {},\n            orderState: []\n        },\n        created() {\n            this.load()\n        },\n        methods: {\n            getMsg(fn) {\n                const self = this\n                console.log('fetch-msg-start' + new Date().toLocaleString());\n                fetch.call(self, {\n                    type: 'get',\n                    url: '/api/message/isread',\n                    success({data}) {\n                        const msgSysId = data.noticeId\n                        const hasMsgOther = data.read\n                        console.log('fetch-msg-end' + new Date().toLocaleString());\n                        storage.getItem('MSG_SYS_ID', ({data}) => {\n                            if (data === 'undefined') {\n                                storage.setItem('MSG_SYS_ID', msgSysId, () => {\n                                    self.hasMsg = true\n                                })\n                            } else if (data < msgSysId) {\n                                storage.setItem('MSG_SYS_ID', msgSysId, () => {\n                                    self.hasMsg = true\n                                })\n                            } else if (hasMsgOther) {\n                                self.hasMsg = true\n                            } else {\n                                self.hasMsg = false\n                            }\n                        })\n                    },\n                    error(err) {\n                        const {toast} = require('@weex-module/modal')\n                        toast({message: err.errmsg})\n                    },\n                    ever: () => {\n                        fn && fn(null)\n                    }\n                })\n            },\n            getOrder(fn) {\n                console.log('fetch-order-start' + new Date().toLocaleString());\n                fetch.call(this, {\n                    type: 'get',\n                    url: '/api/order/list',\n                    data: {\n                        pageNum: 0,\n                        pageSize: 0\n                    },\n                    success: ({data: {orderStateInfoList}}) => {\n                        console.log('fetch-order-end' + new Date().toLocaleString());\n                        this.orderState = [\n                            orderStateInfoList[1].count,\n                            orderStateInfoList[2].count,\n                            orderStateInfoList[4].count,\n                            orderStateInfoList[5].count\n                        ]\n                    },\n                    ever: () => {\n                        fn && fn(null)\n                    }\n                })\n            },\n            load(fn) {\n                series([\n                    this.getOrder.bind(this),\n                    this.getMsg.bind(this)\n                ], () => {\n                    fn && fn()\n                })\n            },\n            onrefresh() {\n                this.loading = 'show'\n                this.load(() => {\n                    this.loading = 'hide'\n                })\n            }\n        }\n    }\n</script>\n\n```\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248831957",
      "html_url": "https://github.com/alibaba/weex/issues/1273#issuecomment-248831957",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1273",
      "id": 248831957,
      "user": {
        "login": "acton393",
        "id": 11631084,
        "avatar_url": "https://avatars1.githubusercontent.com/u/11631084?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/acton393",
        "html_url": "https://github.com/acton393",
        "followers_url": "https://api.github.com/users/acton393/followers",
        "following_url": "https://api.github.com/users/acton393/following{/other_user}",
        "gists_url": "https://api.github.com/users/acton393/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/acton393/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/acton393/subscriptions",
        "organizations_url": "https://api.github.com/users/acton393/orgs",
        "repos_url": "https://api.github.com/users/acton393/repos",
        "events_url": "https://api.github.com/users/acton393/events{/privacy}",
        "received_events_url": "https://api.github.com/users/acton393/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-22T07:30:05Z",
      "updated_at": "2016-09-22T07:30:24Z",
      "body": "@lmnsg 建议你先去掉`async.series` 单独跑一下 stream 的方法\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/249467788",
      "html_url": "https://github.com/alibaba/weex/issues/1273#issuecomment-249467788",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1273",
      "id": 249467788,
      "user": {
        "login": "lmnsg",
        "id": 10400425,
        "avatar_url": "https://avatars2.githubusercontent.com/u/10400425?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/lmnsg",
        "html_url": "https://github.com/lmnsg",
        "followers_url": "https://api.github.com/users/lmnsg/followers",
        "following_url": "https://api.github.com/users/lmnsg/following{/other_user}",
        "gists_url": "https://api.github.com/users/lmnsg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/lmnsg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lmnsg/subscriptions",
        "organizations_url": "https://api.github.com/users/lmnsg/orgs",
        "repos_url": "https://api.github.com/users/lmnsg/repos",
        "events_url": "https://api.github.com/users/lmnsg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/lmnsg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-26T02:43:02Z",
      "updated_at": "2016-09-26T02:43:02Z",
      "body": "@acton393 去掉async.series 后直接：\n\n``` js\nthis.getOrder()\nthis.getMsg(fn)\n```\n\n问题依然重现\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/249563188",
      "html_url": "https://github.com/alibaba/weex/issues/1273#issuecomment-249563188",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1273",
      "id": 249563188,
      "user": {
        "login": "acton393",
        "id": 11631084,
        "avatar_url": "https://avatars1.githubusercontent.com/u/11631084?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/acton393",
        "html_url": "https://github.com/acton393",
        "followers_url": "https://api.github.com/users/acton393/followers",
        "following_url": "https://api.github.com/users/acton393/following{/other_user}",
        "gists_url": "https://api.github.com/users/acton393/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/acton393/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/acton393/subscriptions",
        "organizations_url": "https://api.github.com/users/acton393/orgs",
        "repos_url": "https://api.github.com/users/acton393/repos",
        "events_url": "https://api.github.com/users/acton393/events{/privacy}",
        "received_events_url": "https://api.github.com/users/acton393/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-26T13:03:07Z",
      "updated_at": "2016-09-26T13:03:07Z",
      "body": "hi @lmnsg  麻烦你贴一下 可以复现问题的完整的demo case，应该还差 <template> 部分\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/255726697",
      "html_url": "https://github.com/alibaba/weex/issues/1273#issuecomment-255726697",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1273",
      "id": 255726697,
      "user": {
        "login": "Jinjiang",
        "id": 206848,
        "avatar_url": "https://avatars2.githubusercontent.com/u/206848?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Jinjiang",
        "html_url": "https://github.com/Jinjiang",
        "followers_url": "https://api.github.com/users/Jinjiang/followers",
        "following_url": "https://api.github.com/users/Jinjiang/following{/other_user}",
        "gists_url": "https://api.github.com/users/Jinjiang/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Jinjiang/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Jinjiang/subscriptions",
        "organizations_url": "https://api.github.com/users/Jinjiang/orgs",
        "repos_url": "https://api.github.com/users/Jinjiang/repos",
        "events_url": "https://api.github.com/users/Jinjiang/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Jinjiang/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-10-24T12:29:12Z",
      "updated_at": "2016-10-24T12:29:12Z",
      "body": "这个问题长时间没有讨论和反馈，如果有更多讨论仍然可以在这里继续，但这里会做close处理\n谢谢\n"
    }
  ],
  "created_at": "2016-09-21T09:03:46Z",
  "updated_at": "2016-10-24T12:29:12Z",
  "closed_at": "2016-10-24T12:29:12Z",
  "body": "在 ios 上同时调起 2个 stream.fetch 的时候，程序会卡住  有一行 log 如下:\n\n2016-09-21 17:03:25.160419 WeexDemo[15943:497519] [] nw_endpoint_flow_service_writes [21 192.168.8.188:8002 ready socket-flow (satisfied)] Write request has 4294967295 frame count, 0 byte count\n",
  "closed_by": {
    "login": "Jinjiang",
    "id": 206848,
    "avatar_url": "https://avatars2.githubusercontent.com/u/206848?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Jinjiang",
    "html_url": "https://github.com/Jinjiang",
    "followers_url": "https://api.github.com/users/Jinjiang/followers",
    "following_url": "https://api.github.com/users/Jinjiang/following{/other_user}",
    "gists_url": "https://api.github.com/users/Jinjiang/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Jinjiang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Jinjiang/subscriptions",
    "organizations_url": "https://api.github.com/users/Jinjiang/orgs",
    "repos_url": "https://api.github.com/users/Jinjiang/repos",
    "events_url": "https://api.github.com/users/Jinjiang/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Jinjiang/received_events",
    "type": "User",
    "site_admin": false
  }
}
