{
  "url": "https://api.github.com/repos/alibaba/weex/issues/1511",
  "repository_url": "https://api.github.com/repos/alibaba/weex",
  "labels_url": "https://api.github.com/repos/alibaba/weex/issues/1511/labels{/name}",
  "comments_url": "https://api.github.com/repos/alibaba/weex/issues/1511/comments",
  "events_url": "https://api.github.com/repos/alibaba/weex/issues/1511/events",
  "html_url": "https://github.com/alibaba/weex/issues/1511",
  "id": 185289589,
  "number": 1511,
  "title": "Xcode 集成weex SDK  加载js文件失败",
  "user": {
    "login": "emptywalker",
    "id": 12522809,
    "avatar_url": "https://avatars0.githubusercontent.com/u/12522809?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/emptywalker",
    "html_url": "https://github.com/emptywalker",
    "followers_url": "https://api.github.com/users/emptywalker/followers",
    "following_url": "https://api.github.com/users/emptywalker/following{/other_user}",
    "gists_url": "https://api.github.com/users/emptywalker/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/emptywalker/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/emptywalker/subscriptions",
    "organizations_url": "https://api.github.com/users/emptywalker/orgs",
    "repos_url": "https://api.github.com/users/emptywalker/repos",
    "events_url": "https://api.github.com/users/emptywalker/events{/privacy}",
    "received_events_url": "https://api.github.com/users/emptywalker/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": [
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/256275913",
      "html_url": "https://github.com/alibaba/weex/issues/1511#issuecomment-256275913",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1511",
      "id": 256275913,
      "user": {
        "login": "emptywalker",
        "id": 12522809,
        "avatar_url": "https://avatars0.githubusercontent.com/u/12522809?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/emptywalker",
        "html_url": "https://github.com/emptywalker",
        "followers_url": "https://api.github.com/users/emptywalker/followers",
        "following_url": "https://api.github.com/users/emptywalker/following{/other_user}",
        "gists_url": "https://api.github.com/users/emptywalker/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/emptywalker/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/emptywalker/subscriptions",
        "organizations_url": "https://api.github.com/users/emptywalker/orgs",
        "repos_url": "https://api.github.com/users/emptywalker/repos",
        "events_url": "https://api.github.com/users/emptywalker/events{/privacy}",
        "received_events_url": "https://api.github.com/users/emptywalker/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-10-26T07:57:12Z",
      "updated_at": "2016-10-26T07:58:24Z",
      "body": "经过多次调试发现以下问题:\n\n```\n    WX_MONITOR_INSTANCE_PERF_START(WXPTJSDownload, self);\n\n        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];\n        [request setValue:[WXUtility userAgent] forHTTPHeaderField:@\"User-Agent\"];\n        [request setValue:@\"weex\" forHTTPHeaderField:@\"f-refer\"];\n\n        id<WXNetworkProtocol> networkHandler = [self networkHandler];\n\n        __block NSURLResponse *urlResponse;\n        [networkHandler sendRequest:request\n                   withSendingData:^(int64_t bytesSent, int64_t totalBytes) {}\n                      withResponse:^(NSURLResponse *response) {\n                          urlResponse = response;\n                      }\n                   withReceiveData:^(NSData *data) {}\n                   withCompeletion:^(NSData *totalData, NSError *error) {\n            //TODO 304\n            if (!error && [urlResponse isKindOfClass:[NSHTTPURLResponse class]] && ((NSHTTPURLResponse *)urlResponse).statusCode != 200) {\n                error = [NSError errorWithDomain:WX_ERROR_DOMAIN\n                                            code:((NSHTTPURLResponse *)urlResponse).statusCode\n                                        userInfo:@{@\"message\":@\"status code error.\"}];\n            }\n\n            if (error) {\n                NSString *errorMessage = [NSString stringWithFormat:@\"Connection to %@ occurs an error:%@\", request.URL, error.localizedDescription];\n                WX_MONITOR_FAIL_ON_PAGE(WXMTJSDownload, WX_ERR_JSBUNDLE_DOWNLOAD, errorMessage, weakSelf.pageName);\n\n                if (weakSelf.onFailed) {\n                    weakSelf.onFailed(error);\n                }\n                return;\n            }\n\n            if (!totalData) {\n                NSString *errorMessage = [NSString stringWithFormat:@\"Connection to %@ but no data return\", request.URL];\n                WX_MONITOR_FAIL_ON_PAGE(WXMTJSDownload, WX_ERR_JSBUNDLE_DOWNLOAD, errorMessage, weakSelf.pageName);\n\n                if (weakSelf.onFailed) {\n                    weakSelf.onFailed(error);\n                }\n                return;\n            }\n\n            NSString *script = [[NSString alloc] initWithData:totalData encoding:NSUTF8StringEncoding];\n            if (!script) {\n                WX_MONITOR_FAIL_ON_PAGE(WXMTJSDownload, WX_ERR_JSBUNDLE_STRING_CONVERT, @\"data converting to string failed.\", weakSelf.pageName)\n                return;\n            }\n\n            WX_MONITOR_SUCCESS_ON_PAGE(WXMTJSDownload, weakSelf.pageName);\n            WX_MONITOR_INSTANCE_PERF_END(WXPTJSDownload, weakSelf);\n\n            [weakSelf renderView:script options:newOptions data:data];\n        }];\n```\n\n### 在我的项目中，当程序执行到这个请求js文件的网络方法时，不会走`WXNetworkDefaultImpl`中的创建请求的方法:\n\n```\n- (id)sendRequest:(NSURLRequest *)request withSendingData:(void (^)(int64_t, int64_t))sendDataCallback\n                                             withResponse:(void (^)(NSURLResponse *))responseCallback\n                                          withReceiveData:(void (^)(NSData *))receiveDataCallback\n                                          withCompeletion:(void (^)(NSData *, NSError *))compeletionCallback\n{\n    WXNetworkCallbackInfo *info = [WXNetworkCallbackInfo new];\n    info.sendDataCallback = sendDataCallback;\n    info.responseCallback = responseCallback;\n    info.receiveDataCallback = receiveDataCallback;\n    info.compeletionCallback = compeletionCallback;\n\n    if (!_session) {\n        _session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration]\n                                                 delegate:self\n                                            delegateQueue:[NSOperationQueue mainQueue]];\n    }\n\n    NSURLSessionDataTask *task = [_session dataTaskWithRequest:request];\n    if (!_callbacks) {\n        _callbacks = [NSMutableDictionary dictionary];\n    }\n    [_callbacks setObject:info forKey:task];\n    [task resume];\n\n    return task;\n}\n```\n\n### 所以导致js文件请求根本就没有发出来，就去执行了`WXBridgeContext.m`中的，下列代码，由于`sendQueue = nil`然后结束了运行\n\n```\n- (void)executeJsMethod:(WXBridgeMethod *)method\n{\n    WXAssertBridgeThread();\n\n    if (!method.instance) {\n        WXLogError(@\"Instance doesn't exist!\");\n        return;\n    }\n\n    NSMutableArray *sendQueue = self.sendQueue[method.instance];\n    if (!sendQueue) {\n        WXLogInfo(@\"No send queue for instance:%@, may it has been destroyed so method:%@ is ignored\", method.instance, method.method);\n        return;\n    }\n\n    [sendQueue addObject:method];\n    [self performSelector:@selector(_sendQueueLoop) withObject:nil];\n}\n```\n\n# 表示求同学解答下哈，实在是有点不太明白，我的所有配置和playground中一致，为啥会出现这样的情况呢\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/256281444",
      "html_url": "https://github.com/alibaba/weex/issues/1511#issuecomment-256281444",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1511",
      "id": 256281444,
      "user": {
        "login": "emptywalker",
        "id": 12522809,
        "avatar_url": "https://avatars0.githubusercontent.com/u/12522809?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/emptywalker",
        "html_url": "https://github.com/emptywalker",
        "followers_url": "https://api.github.com/users/emptywalker/followers",
        "following_url": "https://api.github.com/users/emptywalker/following{/other_user}",
        "gists_url": "https://api.github.com/users/emptywalker/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/emptywalker/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/emptywalker/subscriptions",
        "organizations_url": "https://api.github.com/users/emptywalker/orgs",
        "repos_url": "https://api.github.com/users/emptywalker/repos",
        "events_url": "https://api.github.com/users/emptywalker/events{/privacy}",
        "received_events_url": "https://api.github.com/users/emptywalker/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-10-26T08:24:31Z",
      "updated_at": "2016-10-26T08:24:31Z",
      "body": "不好意思     我查到了原因，是我写好的初始化SDK的方法 ，没有调用\n"
    }
  ],
  "created_at": "2016-10-26T03:37:45Z",
  "updated_at": "2016-10-26T08:24:37Z",
  "closed_at": "2016-10-26T08:24:37Z",
  "body": "## 描述\n\n我在项目中集成weex，所用的sdk版本是weex0.8.0，然后本地pods管理的路径和playground中一致，即sdk与项目根目录同级。\n\n然后我在初始化好了weex之后，去加载一个我已经编译好的js文件，在Xcode中出现以下错误\n\n```\n<Weex>[info]WXBridgeContext.m:292, No send queue for instance:0, may it has been destroyed so method:fireEvent is ignored \u001b[;\n```\n## 问题\n\n我将同样的js文件，放在playground中就能够加载成功。我查看了`WXBridgeContext.m:292`这个位置的代码，由于在sdk中，没有断点调试\n## 求解这是什么原因造成的\n",
  "closed_by": {
    "login": "emptywalker",
    "id": 12522809,
    "avatar_url": "https://avatars0.githubusercontent.com/u/12522809?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/emptywalker",
    "html_url": "https://github.com/emptywalker",
    "followers_url": "https://api.github.com/users/emptywalker/followers",
    "following_url": "https://api.github.com/users/emptywalker/following{/other_user}",
    "gists_url": "https://api.github.com/users/emptywalker/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/emptywalker/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/emptywalker/subscriptions",
    "organizations_url": "https://api.github.com/users/emptywalker/orgs",
    "repos_url": "https://api.github.com/users/emptywalker/repos",
    "events_url": "https://api.github.com/users/emptywalker/events{/privacy}",
    "received_events_url": "https://api.github.com/users/emptywalker/received_events",
    "type": "User",
    "site_admin": false
  }
}
