{
  "url": "https://api.github.com/repos/alibaba/weex/issues/1249",
  "repository_url": "https://api.github.com/repos/alibaba/weex",
  "labels_url": "https://api.github.com/repos/alibaba/weex/issues/1249/labels{/name}",
  "comments_url": "https://api.github.com/repos/alibaba/weex/issues/1249/comments",
  "events_url": "https://api.github.com/repos/alibaba/weex/issues/1249/events",
  "html_url": "https://github.com/alibaba/weex/issues/1249",
  "id": 177742232,
  "number": 1249,
  "title": "[Android]WXStreamModuleè·å–emojiè¡¨æƒ…é—®é¢˜",
  "user": {
    "login": "zjutkz",
    "id": 9446934,
    "avatar_url": "https://avatars1.githubusercontent.com/u/9446934?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zjutkz",
    "html_url": "https://github.com/zjutkz",
    "followers_url": "https://api.github.com/users/zjutkz/followers",
    "following_url": "https://api.github.com/users/zjutkz/following{/other_user}",
    "gists_url": "https://api.github.com/users/zjutkz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zjutkz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zjutkz/subscriptions",
    "organizations_url": "https://api.github.com/users/zjutkz/orgs",
    "repos_url": "https://api.github.com/users/zjutkz/repos",
    "events_url": "https://api.github.com/users/zjutkz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zjutkz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": [
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/247970301",
      "html_url": "https://github.com/alibaba/weex/issues/1249#issuecomment-247970301",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1249",
      "id": 247970301,
      "user": {
        "login": "sospartan",
        "id": 115201,
        "avatar_url": "https://avatars0.githubusercontent.com/u/115201?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sospartan",
        "html_url": "https://github.com/sospartan",
        "followers_url": "https://api.github.com/users/sospartan/followers",
        "following_url": "https://api.github.com/users/sospartan/following{/other_user}",
        "gists_url": "https://api.github.com/users/sospartan/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sospartan/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sospartan/subscriptions",
        "organizations_url": "https://api.github.com/users/sospartan/orgs",
        "repos_url": "https://api.github.com/users/sospartan/repos",
        "events_url": "https://api.github.com/users/sospartan/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sospartan/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-19T11:37:11Z",
      "updated_at": "2016-09-19T11:37:11Z",
      "body": "@zjutkz æ¬¢è¿æ¥æäº¤å¯¹åº”çš„PR\n@YorkShen ç›®å‰textä¹Ÿè¿˜ä¸æ”¯æŒemojiå§\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/247974598",
      "html_url": "https://github.com/alibaba/weex/issues/1249#issuecomment-247974598",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1249",
      "id": 247974598,
      "user": {
        "login": "YorkShen",
        "id": 4162544,
        "avatar_url": "https://avatars2.githubusercontent.com/u/4162544?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/YorkShen",
        "html_url": "https://github.com/YorkShen",
        "followers_url": "https://api.github.com/users/YorkShen/followers",
        "following_url": "https://api.github.com/users/YorkShen/following{/other_user}",
        "gists_url": "https://api.github.com/users/YorkShen/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/YorkShen/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/YorkShen/subscriptions",
        "organizations_url": "https://api.github.com/users/YorkShen/orgs",
        "repos_url": "https://api.github.com/users/YorkShen/repos",
        "events_url": "https://api.github.com/users/YorkShen/events{/privacy}",
        "received_events_url": "https://api.github.com/users/YorkShen/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-19T12:01:24Z",
      "updated_at": "2016-09-19T12:01:24Z",
      "body": "weex androidç›®å‰ä¸æ”¯æŒemojiï¼Œä¼šcrashã€‚ @zjutkz \n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/247975582",
      "html_url": "https://github.com/alibaba/weex/issues/1249#issuecomment-247975582",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1249",
      "id": 247975582,
      "user": {
        "login": "zjutkz",
        "id": 9446934,
        "avatar_url": "https://avatars1.githubusercontent.com/u/9446934?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/zjutkz",
        "html_url": "https://github.com/zjutkz",
        "followers_url": "https://api.github.com/users/zjutkz/followers",
        "following_url": "https://api.github.com/users/zjutkz/following{/other_user}",
        "gists_url": "https://api.github.com/users/zjutkz/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/zjutkz/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zjutkz/subscriptions",
        "organizations_url": "https://api.github.com/users/zjutkz/orgs",
        "repos_url": "https://api.github.com/users/zjutkz/repos",
        "events_url": "https://api.github.com/users/zjutkz/events{/privacy}",
        "received_events_url": "https://api.github.com/users/zjutkz/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-19T12:07:17Z",
      "updated_at": "2016-09-19T12:07:17Z",
      "body": "@YorkShen ä½ çš„æ„æ€æ˜¯å³ä½¿èƒ½è§£æçš„å‡ºæ¥ï¼Œåœ¨å¯¹åº”çš„Textç»„ä»¶é‡Œä½¿ç”¨äº†emojiå°±ä¼šcrashå—ï¼Ÿ(æ²¡çœ‹è¿‡textç»„ä»¶çš„æºç ï¼Œä¸å¤ªæ¸…æ¥šè¿™æ–¹é¢çš„é€»è¾‘)ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä¹‹åä¼šæ”¯æŒå—ï¼Ÿ\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248188053",
      "html_url": "https://github.com/alibaba/weex/issues/1249#issuecomment-248188053",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1249",
      "id": 248188053,
      "user": {
        "login": "YorkShen",
        "id": 4162544,
        "avatar_url": "https://avatars2.githubusercontent.com/u/4162544?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/YorkShen",
        "html_url": "https://github.com/YorkShen",
        "followers_url": "https://api.github.com/users/YorkShen/followers",
        "following_url": "https://api.github.com/users/YorkShen/following{/other_user}",
        "gists_url": "https://api.github.com/users/YorkShen/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/YorkShen/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/YorkShen/subscriptions",
        "organizations_url": "https://api.github.com/users/YorkShen/orgs",
        "repos_url": "https://api.github.com/users/YorkShen/repos",
        "events_url": "https://api.github.com/users/YorkShen/events{/privacy}",
        "received_events_url": "https://api.github.com/users/YorkShen/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-20T02:54:25Z",
      "updated_at": "2016-09-20T02:54:25Z",
      "body": "Ref #350  @zjutkz \n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248819950",
      "html_url": "https://github.com/alibaba/weex/issues/1249#issuecomment-248819950",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1249",
      "id": 248819950,
      "user": {
        "login": "zjutkz",
        "id": 9446934,
        "avatar_url": "https://avatars1.githubusercontent.com/u/9446934?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/zjutkz",
        "html_url": "https://github.com/zjutkz",
        "followers_url": "https://api.github.com/users/zjutkz/followers",
        "following_url": "https://api.github.com/users/zjutkz/following{/other_user}",
        "gists_url": "https://api.github.com/users/zjutkz/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/zjutkz/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zjutkz/subscriptions",
        "organizations_url": "https://api.github.com/users/zjutkz/orgs",
        "repos_url": "https://api.github.com/users/zjutkz/repos",
        "events_url": "https://api.github.com/users/zjutkz/events{/privacy}",
        "received_events_url": "https://api.github.com/users/zjutkz/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-22T06:05:34Z",
      "updated_at": "2016-09-22T06:05:34Z",
      "body": "@YorkShen å…³äºemojiçš„é—®é¢˜ï¼Œå½“æˆ‘åœ¨é€šè¿‡stream.fetchå»è·å–ç½‘ç»œæ•°æ®ä¹‹åï¼Œåœ¨WXStreamModuleçš„å¯¹åº”æˆåŠŸå›è°ƒä¸­æ‰“æ–­ç‚¹ï¼Œå‘ç°[å¾—åˆ°çš„æ•°æ®æ˜¯è¿™æ ·çš„](https://github.com/zjutkz/weex/blob/dev/android/problems/weex_emoji_1.png)\nå¯ä»¥çœ‹åˆ°emojiè¢«è½¬ä¹‰äº†ï¼Œè€Œè¿™æ ·æˆ‘æ­£å¸¸çš„TextViewä¸­æ˜¯å¯ä»¥æ˜¾ç¤ºçš„ï¼Œä½†æ˜¯å½“æˆ‘æŠŠæ–­ç‚¹æ‰“åˆ°äº†WXBridgeManagerçš„callNativeæ–¹æ³•ä¸­æ—¶ï¼Œ[æ•°æ®å˜æˆäº†è¿™æ ·](https://github.com/zjutkz/weex/blob/dev/android/problems/weex_emoji_2.png)\nå¯ä»¥çœ‹åˆ°ï¼Œemojiå˜æˆäº†å…¶ä»–å¥‡æ€ªçš„å­—ç¬¦ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰ä¸€æ ·è½¬ä¹‰çš„ã€‚\nWXStreamModuleçš„å›è°ƒä¸­æ­£ç¡®ï¼Œå¯ä»¥ç¡®å®šç½‘ç»œæ•°æ®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯WXBridgeManagerçš„callNativeæ–¹æ³•ä¸­å‡ºäº†é”™ï¼Œè¯´æ˜JSFrameworkå±‚å¤„ç†çš„æ—¶å€™æŠŠå®ƒå˜æˆäº†é”™è¯¯çš„ä¸œè¥¿ï¼Œè¿™ä¸ªæ˜¯v8çš„é—®é¢˜å—ï¼Ÿè¿˜æ˜¯å…¶ä»–ä»€ä¹ˆåŸå› ï¼Ÿ\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248831829",
      "html_url": "https://github.com/alibaba/weex/issues/1249#issuecomment-248831829",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1249",
      "id": 248831829,
      "user": {
        "login": "YorkShen",
        "id": 4162544,
        "avatar_url": "https://avatars2.githubusercontent.com/u/4162544?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/YorkShen",
        "html_url": "https://github.com/YorkShen",
        "followers_url": "https://api.github.com/users/YorkShen/followers",
        "following_url": "https://api.github.com/users/YorkShen/following{/other_user}",
        "gists_url": "https://api.github.com/users/YorkShen/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/YorkShen/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/YorkShen/subscriptions",
        "organizations_url": "https://api.github.com/users/YorkShen/orgs",
        "repos_url": "https://api.github.com/users/YorkShen/repos",
        "events_url": "https://api.github.com/users/YorkShen/events{/privacy}",
        "received_events_url": "https://api.github.com/users/YorkShen/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-22T07:29:15Z",
      "updated_at": "2016-09-22T07:29:15Z",
      "body": "emojiä¸æ˜¯modified UTF-8å­—ç¬¦ï¼ŒAndroid NDKåªæ”¯æŒModified UTF-8ï¼Œå¤„ç†å…¶ä»–UTF-8å­—ç¬¦ï¼Œä¼šå‡ºç°å¼‚å¸¸ç°è±¡ã€‚ https://developer.android.com/training/articles/perf-jni.html#UTF_8_and_UTF_16_strings @zavakid \n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248835875",
      "html_url": "https://github.com/alibaba/weex/issues/1249#issuecomment-248835875",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1249",
      "id": 248835875,
      "user": {
        "login": "zjutkz",
        "id": 9446934,
        "avatar_url": "https://avatars1.githubusercontent.com/u/9446934?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/zjutkz",
        "html_url": "https://github.com/zjutkz",
        "followers_url": "https://api.github.com/users/zjutkz/followers",
        "following_url": "https://api.github.com/users/zjutkz/following{/other_user}",
        "gists_url": "https://api.github.com/users/zjutkz/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/zjutkz/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zjutkz/subscriptions",
        "organizations_url": "https://api.github.com/users/zjutkz/orgs",
        "repos_url": "https://api.github.com/users/zjutkz/repos",
        "events_url": "https://api.github.com/users/zjutkz/events{/privacy}",
        "received_events_url": "https://api.github.com/users/zjutkz/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-22T07:54:30Z",
      "updated_at": "2016-09-22T07:54:30Z",
      "body": "@YorkShen OK,thanks\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248856847",
      "html_url": "https://github.com/alibaba/weex/issues/1249#issuecomment-248856847",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1249",
      "id": 248856847,
      "user": {
        "login": "YorkShen",
        "id": 4162544,
        "avatar_url": "https://avatars2.githubusercontent.com/u/4162544?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/YorkShen",
        "html_url": "https://github.com/YorkShen",
        "followers_url": "https://api.github.com/users/YorkShen/followers",
        "following_url": "https://api.github.com/users/YorkShen/following{/other_user}",
        "gists_url": "https://api.github.com/users/YorkShen/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/YorkShen/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/YorkShen/subscriptions",
        "organizations_url": "https://api.github.com/users/YorkShen/orgs",
        "repos_url": "https://api.github.com/users/YorkShen/repos",
        "events_url": "https://api.github.com/users/YorkShen/events{/privacy}",
        "received_events_url": "https://api.github.com/users/YorkShen/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-22T09:46:35Z",
      "updated_at": "2016-09-22T09:46:35Z",
      "body": "å‚è€ƒè¿™ä¸ª[commit](https://android-review.googlesource.com/#/c/130121/), android 6.0 ndkä¸ä¼šcrashï¼Œ6.0ä»¥ä¸‹çš„ç‰ˆæœ¬æœ‰å¯èƒ½crashã€‚è€ƒè™‘ä½¿ç”¨byte[]æ•°ç»„è¿›è¡Œæ•°æ®é€šè®¯ï¼Œç»•è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå‚è€ƒè¿™ä¸ªæäº¤ï¼Œç›®å‰è¿˜æ²¡æœ‰éªŒè¯64ä½ç³»ç»Ÿå’Œjniæ³„éœ² https://github.com/sospartan/weex/tree/android-bugfix-utf-8 ã€‚è¿™ä¸ªissueå…ˆå…³é—­ï¼Œè¿›åº¦è·Ÿè¸ª Ref #350 @zjutkz \n"
    }
  ],
  "created_at": "2016-09-19T09:43:41Z",
  "updated_at": "2016-09-22T09:46:35Z",
  "closed_at": "2016-09-22T09:46:35Z",
  "body": "å¦‚æœé€šè¿‡streamå»è¯·æ±‚æ•°æ®ï¼Œtypeè®¾ç½®æˆjsonï¼Œå¹¶ä¸”åå°æ¥å£è¿”å›çš„æ•°æ®ä¸­åŒ…å«emojiè¡¨æƒ…çš„è¯ï¼Œemojiä¼šè§£æå¤±è´¥ï¼Œå¹¶ä¸”åœ¨ç‰¹å®šæƒ…å†µä¸‹ä¼šé€ æˆjsonçš„è§£æå¤±è´¥ã€‚\nåŸå› æ˜¯å› ä¸ºåœ¨WXStreamModuleçš„fetchæ–¹æ³•ä¸­ï¼Œå½“èµ°åˆ°æˆåŠŸçš„å›è°ƒä»¥åï¼Œä¼šè°ƒç”¨readAsStringæ–¹æ³•å»å°†byteæ•°ç»„è½¬æ¢æˆStringï¼š\n`String respData = readAsString(response.originalData,\n                headers!=null?headers.get(\"Content-Type\"):\"\"\n              );`\nåœ¨è½¬åŒ–çš„è¿‡ç¨‹ä¸­emojiæ˜¯æ— æ³•è§£æçš„ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚\nç¬¬äºŒé—®é¢˜æ˜¯åœ¨ç‰¹å®šæƒ…å†µä¸‹å¶å‘çš„ï¼Œå¦‚æœè¿™ä¸ªemojiæ˜¯ä½äºå­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œé‚£ä¹ˆåœ¨byte[]è½¬åŒ–æˆStringçš„è¿‡ç¨‹ä¸­ï¼Œåå¼•å·ä¼šä¸¢å¤±ï¼Œå°±åƒè¿™æ ·ï¼š\nåå°ä¸‹å‘çš„æ˜¯\"xxxxxxxxxğŸ˜„\"ï¼Œé€šè¿‡byte[]æ¢æˆæˆStringä¹‹åï¼Œå˜æˆäº†\"xxxxxxxxxxxoìŒ©Ä¢,å¯ä»¥çœ‹åˆ°åå¼•å·ä¸¢å¤±äº†ã€‚\næ‰€ä»¥æˆ‘çš„å»ºè®®æ˜¯\n`resp.put(\"data\",options.getType() != Options.Type.text? JSONObject.parse(respData):respData);`\nåœ¨è½¬åŒ–æˆjsonçš„æ—¶å€™ï¼Œå…¥å‚ä¸è¦æ˜¯Stringï¼ŒfastJsonæä¾›äº†å…¥å‚æ˜¯byte[]çš„æ–¹æ³•ï¼Œç›´æ¥ç”¨æ¯”è¾ƒåˆé€‚ã€‚\nè‡³äºè½¬æ¢æˆStringä¹‹åemojiä¸¢å¤±çš„æƒ…å†µã€‚ã€‚ã€‚è²Œä¼¼æ²¡ä»€ä¹ˆå¥½çš„åŠæ³•ã€‚\n"
}
