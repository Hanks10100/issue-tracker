{
  "url": "https://api.github.com/repos/alibaba/weex/issues/860",
  "repository_url": "https://api.github.com/repos/alibaba/weex",
  "labels_url": "https://api.github.com/repos/alibaba/weex/issues/860/labels{/name}",
  "comments_url": "https://api.github.com/repos/alibaba/weex/issues/860/comments",
  "events_url": "https://api.github.com/repos/alibaba/weex/issues/860/events",
  "html_url": "https://github.com/alibaba/weex/issues/860",
  "id": 167328976,
  "number": 860,
  "title": "[BUG] Android 中List 给Cell配置了scope之后很容易发生crash",
  "user": {
    "login": "LeeJay0226",
    "id": 7502237,
    "avatar_url": "https://avatars1.githubusercontent.com/u/7502237?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LeeJay0226",
    "html_url": "https://github.com/LeeJay0226",
    "followers_url": "https://api.github.com/users/LeeJay0226/followers",
    "following_url": "https://api.github.com/users/LeeJay0226/following{/other_user}",
    "gists_url": "https://api.github.com/users/LeeJay0226/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LeeJay0226/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LeeJay0226/subscriptions",
    "organizations_url": "https://api.github.com/users/LeeJay0226/orgs",
    "repos_url": "https://api.github.com/users/LeeJay0226/repos",
    "events_url": "https://api.github.com/users/LeeJay0226/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LeeJay0226/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "zshshr",
    "id": 5382962,
    "avatar_url": "https://avatars2.githubusercontent.com/u/5382962?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zshshr",
    "html_url": "https://github.com/zshshr",
    "followers_url": "https://api.github.com/users/zshshr/followers",
    "following_url": "https://api.github.com/users/zshshr/following{/other_user}",
    "gists_url": "https://api.github.com/users/zshshr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zshshr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zshshr/subscriptions",
    "organizations_url": "https://api.github.com/users/zshshr/orgs",
    "repos_url": "https://api.github.com/users/zshshr/repos",
    "events_url": "https://api.github.com/users/zshshr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zshshr/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "zshshr",
      "id": 5382962,
      "avatar_url": "https://avatars2.githubusercontent.com/u/5382962?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zshshr",
      "html_url": "https://github.com/zshshr",
      "followers_url": "https://api.github.com/users/zshshr/followers",
      "following_url": "https://api.github.com/users/zshshr/following{/other_user}",
      "gists_url": "https://api.github.com/users/zshshr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zshshr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zshshr/subscriptions",
      "organizations_url": "https://api.github.com/users/zshshr/orgs",
      "repos_url": "https://api.github.com/users/zshshr/repos",
      "events_url": "https://api.github.com/users/zshshr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zshshr/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "miomin",
      "id": 11516748,
      "avatar_url": "https://avatars1.githubusercontent.com/u/11516748?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/miomin",
      "html_url": "https://github.com/miomin",
      "followers_url": "https://api.github.com/users/miomin/followers",
      "following_url": "https://api.github.com/users/miomin/following{/other_user}",
      "gists_url": "https://api.github.com/users/miomin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/miomin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/miomin/subscriptions",
      "organizations_url": "https://api.github.com/users/miomin/orgs",
      "repos_url": "https://api.github.com/users/miomin/repos",
      "events_url": "https://api.github.com/users/miomin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/miomin/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": [
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/234931544",
      "html_url": "https://github.com/alibaba/weex/issues/860#issuecomment-234931544",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/860",
      "id": 234931544,
      "user": {
        "login": "LeeJay0226",
        "id": 7502237,
        "avatar_url": "https://avatars1.githubusercontent.com/u/7502237?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LeeJay0226",
        "html_url": "https://github.com/LeeJay0226",
        "followers_url": "https://api.github.com/users/LeeJay0226/followers",
        "following_url": "https://api.github.com/users/LeeJay0226/following{/other_user}",
        "gists_url": "https://api.github.com/users/LeeJay0226/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/LeeJay0226/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/LeeJay0226/subscriptions",
        "organizations_url": "https://api.github.com/users/LeeJay0226/orgs",
        "repos_url": "https://api.github.com/users/LeeJay0226/repos",
        "events_url": "https://api.github.com/users/LeeJay0226/events{/privacy}",
        "received_events_url": "https://api.github.com/users/LeeJay0226/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-07-25T11:45:41Z",
      "updated_at": "2016-07-25T11:46:23Z",
      "body": "会crash的代码，滑动到最下方，然后往上滚会crash。\n\n```\n<template>\n  <div>\n    <list class=\"list\">\n      <cell class=\"row\" repeat=\"{{rows}}\" index=\"{{$index}}\" scope=\"1\"><div class=\"item\">  <text>row {{id}}</text>  <text if=\"{{$index % 2 == 1}}\">row2 {{id}}</text></div>\n      </cell>\n    </list>\n  </div>\n</template>\n\n<style>\n  .list {\n    height:850px\n  }\n  .item {\n    flex-direction: row;\n    justify-content: space-between;\n    height: 100px;\n    padding:20px;\n  }\n</style>\n\n<script>\n  module.exports = {\n    data: {\n      rows:[{id: 1},{id: 2},{id: 3},{id: 4},{id: 5},{id: 6},{id: 7},{id: 8},{id: 9},{id: 10},{id: 11},{id: 12},{id: 13},{id: 14},{id: 15},{id: 16},{id: 17},{id: 18},{id: 19},{id: 20},{id: 21},{id: 22},{id: 23},{id: 24},{id: 25},{id: 26},{id: 27},{id: 28},{id: 29}\n      ]\n    }\n  }\n</script>\n\n```\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/235239114",
      "html_url": "https://github.com/alibaba/weex/issues/860#issuecomment-235239114",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/860",
      "id": 235239114,
      "user": {
        "login": "zshshr",
        "id": 5382962,
        "avatar_url": "https://avatars2.githubusercontent.com/u/5382962?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/zshshr",
        "html_url": "https://github.com/zshshr",
        "followers_url": "https://api.github.com/users/zshshr/followers",
        "following_url": "https://api.github.com/users/zshshr/following{/other_user}",
        "gists_url": "https://api.github.com/users/zshshr/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/zshshr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zshshr/subscriptions",
        "organizations_url": "https://api.github.com/users/zshshr/orgs",
        "repos_url": "https://api.github.com/users/zshshr/repos",
        "events_url": "https://api.github.com/users/zshshr/events{/privacy}",
        "received_events_url": "https://api.github.com/users/zshshr/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-07-26T11:16:16Z",
      "updated_at": "2016-07-26T11:16:16Z",
      "body": "@LeeJay0226 目前scope使用限制还比较多，android上view的创建和layout相对耗时比较大，因此想提高list复用，要求，scope一样的cell，需要满足view层级和布局完全一致，不然，不允许设置scope相同值\n"
    }
  ],
  "created_at": "2016-07-25T09:56:52Z",
  "updated_at": "2016-08-02T02:03:51Z",
  "closed_at": "2016-08-02T02:03:51Z",
  "body": "背景：在优化Android过程中发现List提供了设置scope，给不同类型Cell设置不同type的功能，以此来优化List的性能，尽可能地减少cell的创建，提高复用率。\n问题：但在实际使用中发现很容易出现问题。即使同一个cell设置了同一个scope，但也会发生crash。出现问题的原因是在实际业务中一个cell中的子元素经常会设置if控制子元素的可见性。若这个cell被复用时，会导致旧的cell和新的cell中子元素数量不一致的情况，导致数组越界，而发生crash。\n发生crash的代码如下：\n\n```\n  @Override\n  public void bindData(WXComponent component) {\n    if(!isLazy()) {\n      if (component == null) {\n        component = this;\n      }\n      super.bindData(component);\n      int count = childCount();\n      for (int i = 0; i < count; i++) {\n        getChild(i).bindData(((WXVContainer)component).getChild(i));\n      }\n    }\n  }\n```\n\n这行代码 getChild(i).bindData(((WXVContainer)component).getChild(i));\n这里由于this 和component可能不相同，导致他们的children也不相同，调用上面这行代码就很容易发生数组越界的crash了。\n"
}
