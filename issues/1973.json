{
  "url": "https://api.github.com/repos/alibaba/weex/issues/1973",
  "repository_url": "https://api.github.com/repos/alibaba/weex",
  "labels_url": "https://api.github.com/repos/alibaba/weex/issues/1973/labels{/name}",
  "comments_url": "https://api.github.com/repos/alibaba/weex/issues/1973/comments",
  "events_url": "https://api.github.com/repos/alibaba/weex/issues/1973/events",
  "html_url": "https://github.com/alibaba/weex/issues/1973",
  "id": 196847812,
  "number": 1973,
  "title": "ios端本地拓展module问题",
  "user": {
    "login": "slidoooor",
    "id": 17105034,
    "avatar_url": "https://avatars3.githubusercontent.com/u/17105034?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slidoooor",
    "html_url": "https://github.com/slidoooor",
    "followers_url": "https://api.github.com/users/slidoooor/followers",
    "following_url": "https://api.github.com/users/slidoooor/following{/other_user}",
    "gists_url": "https://api.github.com/users/slidoooor/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slidoooor/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slidoooor/subscriptions",
    "organizations_url": "https://api.github.com/users/slidoooor/orgs",
    "repos_url": "https://api.github.com/users/slidoooor/repos",
    "events_url": "https://api.github.com/users/slidoooor/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slidoooor/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 359381244,
      "url": "https://api.github.com/repos/alibaba/weex/labels/ios",
      "name": "ios",
      "color": "f9d0c4",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": [
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/268439832",
      "html_url": "https://github.com/alibaba/weex/issues/1973#issuecomment-268439832",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1973",
      "id": 268439832,
      "user": {
        "login": "icepy",
        "id": 3321837,
        "avatar_url": "https://avatars3.githubusercontent.com/u/3321837?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/icepy",
        "html_url": "https://github.com/icepy",
        "followers_url": "https://api.github.com/users/icepy/followers",
        "following_url": "https://api.github.com/users/icepy/following{/other_user}",
        "gists_url": "https://api.github.com/users/icepy/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/icepy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/icepy/subscriptions",
        "organizations_url": "https://api.github.com/users/icepy/orgs",
        "repos_url": "https://api.github.com/users/icepy/repos",
        "events_url": "https://api.github.com/users/icepy/events{/privacy}",
        "received_events_url": "https://api.github.com/users/icepy/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-12-21T05:36:00Z",
      "updated_at": "2016-12-21T05:36:00Z",
      "body": "@slidoooor 梳理一下你的问题，\r\n\r\n1. js 调用 native module，在native module获取坐标参数，callback回js ，然后js 在发送给服务端？\r\n\r\n这是一个编程的问题了，建议你这么处理，下面是伪代码：\r\n\r\n```Objective-C\r\n// 这是你定义的weex module\r\n- (void)location:(NSString *)data callback:(WXModuleKeepAliveCallback)callback\r\n{\r\n     Location *lc = [Location shar: self.weexInstance];\r\n     [lc handlejsrequest:data callback:^(id data){\r\n         callback(data);\r\n    }];\r\n}\r\n```\r\n\r\n```Objective-C\r\ntypedef void(^Callback)(id data);\r\n// Location 类\r\n\r\n@property (nonatomic, strong) NSMutableArray *queue; //1\r\n@property (nonatomic,assign) BOOL lock;\r\n\r\n- (void) handlejsrequest:(id) data callback(Callback) callback\r\n{\r\n    // 1. 写一个queue，将callback push到queue中\r\n\r\n    // 2. 写一个变量锁，一次只完成一次的任务 self.callback = callback;\r\n    if(self.lock){\r\n       self.lock = NO;\r\n       self.callback = callback;\r\n    }\r\n}\r\n\r\n// 假设这个是你获取地址的delegte的实现\r\n- (void) iosLocation:(id) data{\r\n  // 1. 如果你使用方式一 ，将queue中的 callback 取出来，依次执行一次。\r\n  // self.queue，\r\n  \r\n   // 2. 判断lock是否为NO\r\n   if (!self.lock){\r\n       self.callback(data);\r\n       self.lock = YES;\r\n   }\r\n}\r\n```\r\n"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/268723361",
      "html_url": "https://github.com/alibaba/weex/issues/1973#issuecomment-268723361",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1973",
      "id": 268723361,
      "user": {
        "login": "slidoooor",
        "id": 17105034,
        "avatar_url": "https://avatars3.githubusercontent.com/u/17105034?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/slidoooor",
        "html_url": "https://github.com/slidoooor",
        "followers_url": "https://api.github.com/users/slidoooor/followers",
        "following_url": "https://api.github.com/users/slidoooor/following{/other_user}",
        "gists_url": "https://api.github.com/users/slidoooor/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/slidoooor/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/slidoooor/subscriptions",
        "organizations_url": "https://api.github.com/users/slidoooor/orgs",
        "repos_url": "https://api.github.com/users/slidoooor/repos",
        "events_url": "https://api.github.com/users/slidoooor/events{/privacy}",
        "received_events_url": "https://api.github.com/users/slidoooor/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-12-22T05:41:47Z",
      "updated_at": "2016-12-22T05:41:47Z",
      "body": "@icepy \r\n您好,多谢您的建议,但是我之前采用的是和您差不多的方式,先定义了一个带闭包的方法,这个方法在module方法里调用,最后的闭包就是weex 的callback,然后我把这个闭包暂时获取,保存,在代理方法执行之后调用这个闭包,但是还是会报错,难道是线程的原因吗```"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/268727884",
      "html_url": "https://github.com/alibaba/weex/issues/1973#issuecomment-268727884",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1973",
      "id": 268727884,
      "user": {
        "login": "slidoooor",
        "id": 17105034,
        "avatar_url": "https://avatars3.githubusercontent.com/u/17105034?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/slidoooor",
        "html_url": "https://github.com/slidoooor",
        "followers_url": "https://api.github.com/users/slidoooor/followers",
        "following_url": "https://api.github.com/users/slidoooor/following{/other_user}",
        "gists_url": "https://api.github.com/users/slidoooor/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/slidoooor/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/slidoooor/subscriptions",
        "organizations_url": "https://api.github.com/users/slidoooor/orgs",
        "repos_url": "https://api.github.com/users/slidoooor/repos",
        "events_url": "https://api.github.com/users/slidoooor/events{/privacy}",
        "received_events_url": "https://api.github.com/users/slidoooor/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-12-22T06:21:07Z",
      "updated_at": "2016-12-22T06:21:07Z",
      "body": "@icepy \r\n我明白了,文档里说的block是WXModuleCallback,但是还有一种是您说的WXModuleKeepAliveCallback,我用了这个就好使了,多谢啦"
    }
  ],
  "created_at": "2016-12-21T05:12:04Z",
  "updated_at": "2016-12-22T10:14:21Z",
  "closed_at": "2016-12-22T10:14:21Z",
  "body": "现在要给服务端写一个获取当前坐标的方法,拓展了一个类来完成,但是在给服务端返回数据的时候方法里必须要使用闭包返回,现在的问题就是,服务端调用方法的时候,ios本地开启坐标管理器,但是坐标管理器获取经纬度是通过代理回调回来的,在代理方法里边即使把方法里边的WXModuleCallback保存成全局变量在调用也会报错,想麻烦问下如果服务器请求的本地方法需要本地调用代理来取值的时候要通过什么方法能够调用WXModuleCallback这个block\r\n\r\n\r\n"
}
