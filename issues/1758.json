{
  "url": "https://api.github.com/repos/alibaba/weex/issues/1758",
  "repository_url": "https://api.github.com/repos/alibaba/weex",
  "labels_url": "https://api.github.com/repos/alibaba/weex/issues/1758/labels{/name}",
  "comments_url": "https://api.github.com/repos/alibaba/weex/issues/1758/comments",
  "events_url": "https://api.github.com/repos/alibaba/weex/issues/1758/events",
  "html_url": "https://github.com/alibaba/weex/issues/1758",
  "id": 192030766,
  "number": 1758,
  "title": "list组件里，更新数据后 if 没有重新计算导致出错",
  "user": {
    "login": "Neeeo",
    "id": 3702412,
    "avatar_url": "https://avatars3.githubusercontent.com/u/3702412?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Neeeo",
    "html_url": "https://github.com/Neeeo",
    "followers_url": "https://api.github.com/users/Neeeo/followers",
    "following_url": "https://api.github.com/users/Neeeo/following{/other_user}",
    "gists_url": "https://api.github.com/users/Neeeo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Neeeo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Neeeo/subscriptions",
    "organizations_url": "https://api.github.com/users/Neeeo/orgs",
    "repos_url": "https://api.github.com/users/Neeeo/repos",
    "events_url": "https://api.github.com/users/Neeeo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Neeeo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 339914706,
      "url": "https://api.github.com/repos/alibaba/weex/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "bluebird78999",
    "id": 753735,
    "avatar_url": "https://avatars1.githubusercontent.com/u/753735?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bluebird78999",
    "html_url": "https://github.com/bluebird78999",
    "followers_url": "https://api.github.com/users/bluebird78999/followers",
    "following_url": "https://api.github.com/users/bluebird78999/following{/other_user}",
    "gists_url": "https://api.github.com/users/bluebird78999/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bluebird78999/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bluebird78999/subscriptions",
    "organizations_url": "https://api.github.com/users/bluebird78999/orgs",
    "repos_url": "https://api.github.com/users/bluebird78999/repos",
    "events_url": "https://api.github.com/users/bluebird78999/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bluebird78999/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "bluebird78999",
      "id": 753735,
      "avatar_url": "https://avatars1.githubusercontent.com/u/753735?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluebird78999",
      "html_url": "https://github.com/bluebird78999",
      "followers_url": "https://api.github.com/users/bluebird78999/followers",
      "following_url": "https://api.github.com/users/bluebird78999/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluebird78999/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluebird78999/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluebird78999/subscriptions",
      "organizations_url": "https://api.github.com/users/bluebird78999/orgs",
      "repos_url": "https://api.github.com/users/bluebird78999/repos",
      "events_url": "https://api.github.com/users/bluebird78999/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluebird78999/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "fkysly",
      "id": 3274605,
      "avatar_url": "https://avatars1.githubusercontent.com/u/3274605?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fkysly",
      "html_url": "https://github.com/fkysly",
      "followers_url": "https://api.github.com/users/fkysly/followers",
      "following_url": "https://api.github.com/users/fkysly/following{/other_user}",
      "gists_url": "https://api.github.com/users/fkysly/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fkysly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fkysly/subscriptions",
      "organizations_url": "https://api.github.com/users/fkysly/orgs",
      "repos_url": "https://api.github.com/users/fkysly/repos",
      "events_url": "https://api.github.com/users/fkysly/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fkysly/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": [
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/270302213",
      "html_url": "https://github.com/alibaba/weex/issues/1758#issuecomment-270302213",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1758",
      "id": 270302213,
      "user": {
        "login": "fkysly",
        "id": 3274605,
        "avatar_url": "https://avatars1.githubusercontent.com/u/3274605?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fkysly",
        "html_url": "https://github.com/fkysly",
        "followers_url": "https://api.github.com/users/fkysly/followers",
        "following_url": "https://api.github.com/users/fkysly/following{/other_user}",
        "gists_url": "https://api.github.com/users/fkysly/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/fkysly/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/fkysly/subscriptions",
        "organizations_url": "https://api.github.com/users/fkysly/orgs",
        "repos_url": "https://api.github.com/users/fkysly/repos",
        "events_url": "https://api.github.com/users/fkysly/events{/privacy}",
        "received_events_url": "https://api.github.com/users/fkysly/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2017-01-04T06:17:56Z",
      "updated_at": "2017-01-04T06:17:56Z",
      "body": "缺少容错语句，解决方案：http://dotwe.org/b0932434a13942fde82ce1d52e97064d"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/270305304",
      "html_url": "https://github.com/alibaba/weex/issues/1758#issuecomment-270305304",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1758",
      "id": 270305304,
      "user": {
        "login": "Neeeo",
        "id": 3702412,
        "avatar_url": "https://avatars3.githubusercontent.com/u/3702412?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Neeeo",
        "html_url": "https://github.com/Neeeo",
        "followers_url": "https://api.github.com/users/Neeeo/followers",
        "following_url": "https://api.github.com/users/Neeeo/following{/other_user}",
        "gists_url": "https://api.github.com/users/Neeeo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Neeeo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Neeeo/subscriptions",
        "organizations_url": "https://api.github.com/users/Neeeo/orgs",
        "repos_url": "https://api.github.com/users/Neeeo/repos",
        "events_url": "https://api.github.com/users/Neeeo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Neeeo/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2017-01-04T06:47:49Z",
      "updated_at": "2017-01-04T06:47:49Z",
      "body": "这不是容错的问题，在 if 里已经做了容错判断。这里应该是需要重新计算 if， 而不是把责任推到后面，让其他部分增加不必要容错的代码。"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/270825727",
      "html_url": "https://github.com/alibaba/weex/issues/1758#issuecomment-270825727",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1758",
      "id": 270825727,
      "user": {
        "login": "fkysly",
        "id": 3274605,
        "avatar_url": "https://avatars1.githubusercontent.com/u/3274605?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fkysly",
        "html_url": "https://github.com/fkysly",
        "followers_url": "https://api.github.com/users/fkysly/followers",
        "following_url": "https://api.github.com/users/fkysly/following{/other_user}",
        "gists_url": "https://api.github.com/users/fkysly/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/fkysly/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/fkysly/subscriptions",
        "organizations_url": "https://api.github.com/users/fkysly/orgs",
        "repos_url": "https://api.github.com/users/fkysly/repos",
        "events_url": "https://api.github.com/users/fkysly/events{/privacy}",
        "received_events_url": "https://api.github.com/users/fkysly/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2017-01-06T03:56:12Z",
      "updated_at": "2017-01-06T03:56:12Z",
      "body": "if 本身是重新计算了的，但是由于 weex 本身的机制是，数据更新在 DOM 更新之前。所以 if 数据更新为 false 之后，内部的子元素仍然会触发自身的数据更新，找不到字段，导致了出错。\r\n目前，weex 这边进行 if 数据更新之后，不支持阻断其子元素的数据更新。\r\n\r\n因此，有两种解决方案：第一是使用上方的容错方案；第二是使用 track-by ，强制不复用子元素。"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/270826409",
      "html_url": "https://github.com/alibaba/weex/issues/1758#issuecomment-270826409",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1758",
      "id": 270826409,
      "user": {
        "login": "Neeeo",
        "id": 3702412,
        "avatar_url": "https://avatars3.githubusercontent.com/u/3702412?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Neeeo",
        "html_url": "https://github.com/Neeeo",
        "followers_url": "https://api.github.com/users/Neeeo/followers",
        "following_url": "https://api.github.com/users/Neeeo/following{/other_user}",
        "gists_url": "https://api.github.com/users/Neeeo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Neeeo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Neeeo/subscriptions",
        "organizations_url": "https://api.github.com/users/Neeeo/orgs",
        "repos_url": "https://api.github.com/users/Neeeo/repos",
        "events_url": "https://api.github.com/users/Neeeo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Neeeo/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2017-01-06T04:02:31Z",
      "updated_at": "2017-01-06T04:02:31Z",
      "body": "嗯，我现在用的方案就是 track-by 的方式。是否能从 framework 层有个解决方案？或者文档写一下。\r\n我这是踩了坑才探出来，其他人应该是也会被坑。"
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/270843511",
      "html_url": "https://github.com/alibaba/weex/issues/1758#issuecomment-270843511",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1758",
      "id": 270843511,
      "user": {
        "login": "fkysly",
        "id": 3274605,
        "avatar_url": "https://avatars1.githubusercontent.com/u/3274605?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fkysly",
        "html_url": "https://github.com/fkysly",
        "followers_url": "https://api.github.com/users/fkysly/followers",
        "following_url": "https://api.github.com/users/fkysly/following{/other_user}",
        "gists_url": "https://api.github.com/users/fkysly/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/fkysly/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/fkysly/subscriptions",
        "organizations_url": "https://api.github.com/users/fkysly/orgs",
        "repos_url": "https://api.github.com/users/fkysly/repos",
        "events_url": "https://api.github.com/users/fkysly/events{/privacy}",
        "received_events_url": "https://api.github.com/users/fkysly/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2017-01-06T06:50:27Z",
      "updated_at": "2017-01-06T06:50:27Z",
      "body": "恩，这个问题可以记录一下。 @DoranYun "
    },
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/275063032",
      "html_url": "https://github.com/alibaba/weex/issues/1758#issuecomment-275063032",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1758",
      "id": 275063032,
      "user": {
        "login": "DoranYun",
        "id": 16359169,
        "avatar_url": "https://avatars0.githubusercontent.com/u/16359169?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DoranYun",
        "html_url": "https://github.com/DoranYun",
        "followers_url": "https://api.github.com/users/DoranYun/followers",
        "following_url": "https://api.github.com/users/DoranYun/following{/other_user}",
        "gists_url": "https://api.github.com/users/DoranYun/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/DoranYun/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/DoranYun/subscriptions",
        "organizations_url": "https://api.github.com/users/DoranYun/orgs",
        "repos_url": "https://api.github.com/users/DoranYun/repos",
        "events_url": "https://api.github.com/users/DoranYun/events{/privacy}",
        "received_events_url": "https://api.github.com/users/DoranYun/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2017-01-25T09:44:55Z",
      "updated_at": "2017-01-25T09:44:55Z",
      "body": "已补充，https://github.com/alibaba/weex/pull/2407"
    }
  ],
  "created_at": "2016-11-28T15:12:42Z",
  "updated_at": "2017-01-25T09:44:55Z",
  "closed_at": "2017-01-25T09:44:55Z",
  "body": "我用 list 组件，下拉刷新后更新列表数据，但 cell 里的 if 判断条件没有重新计算，导致出错。\r\n我简化后的复现代码如下：\r\n```html\r\n<template>\r\n  <list>\r\n    <cell repeat=\"{{item in list}}\">\r\n      <div if=\"{{(item && item.content)}}\" style=\"width: 200; height: 200;\">\r\n        <text>{{item.content.text}}</text>\r\n      </div>\r\n      <div if=\"{{(item && item.image)}}\" style=\"width: 200; height: 200;\">\r\n        <image style=\"width: 100; height: 100;\" src=\"{{item.image.url}}\"></image>\r\n      </div>\r\n    </cell>\r\n  </list>\r\n</template>\r\n\r\n<style>\r\n  .ct {\r\n    width: 750;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  .img {\r\n    margin-bottom: 20px;\r\n  }\r\n</style>\r\n\r\n<script>\r\n  module.exports = {\r\n    data: {\r\n      ctHeight: 600,\r\n      list:[],\r\n    },\r\n    ready: function () {\r\n      var me = this;\r\n      this.list = [\r\n      {\r\n        idd: 1,\r\n        content: {\r\n          text:'hello,world',\r\n        },\r\n      },\r\n      {\r\n        idd: 2,\r\n        image: {\r\n          url: 'http://gw.alicdn.com/tps/i2/TB1DpsmMpXXXXabaXXX20ySQVXX-512-512.png_400x400.jpg',\r\n        }\r\n      },\r\n      {\r\n        idd: 3,\r\n        content: {\r\n          text:'hello,world',\r\n        },\r\n      },\r\n      {\r\n        idd: 4,\r\n        image: {\r\n          url: 'http://gw.alicdn.com/tps/i2/TB1DpsmMpXXXXabaXXX20ySQVXX-512-512.png_400x400.jpg',\r\n        }\r\n      },\r\n      ];\r\n\r\n      setTimeout(function(){\r\n        console.log('reset ------TOOOOOOOOOO');\r\n        var a = [\r\n      {\r\n        idd: 5,\r\n        image: {\r\n          url: 'http://gw.alicdn.com/tps/i2/TB1DpsmMpXXXXabaXXX20ySQVXX-512-512.png_400x400.jpg',\r\n        }\r\n      },\r\n      {\r\n        idd: 6,\r\n        content: {\r\n          text:'hello,world',\r\n        },\r\n      },\r\n      {\r\n        idd: 7,\r\n        image: {\r\n          url: 'http://gw.alicdn.com/tps/i2/TB1DpsmMpXXXXabaXXX20ySQVXX-512-512.png_400x400.jpg',\r\n        }\r\n      },\r\n      ];\r\n      me.list = a;\r\n      },3000);\r\n    },\r\n  }\r\n</script>\r\n```\r\n\r\n在更新数据后，console 里就提示如下错误：\r\n```\r\n[JS Framework] the \"repeat\" item has changed [Object, Object, Object, __ob__: Observer]\r\n[JS Framework] the \"if\" item was changed undefined\r\nUncaught TypeError: Cannot read property 'text' of undefined(…)value \r\n[Native Error] No cell found for num:3, completed rows:3console.error \r\n```\r\n\r\n错误的原因是 if 没有重新计算，导致不该显示的组件显示了，进而获取不到数据。"
}
