{
  "url": "https://api.github.com/repos/alibaba/weex/issues/2080",
  "repository_url": "https://api.github.com/repos/alibaba/weex",
  "labels_url": "https://api.github.com/repos/alibaba/weex/issues/2080/labels{/name}",
  "comments_url": "https://api.github.com/repos/alibaba/weex/issues/2080/comments",
  "events_url": "https://api.github.com/repos/alibaba/weex/issues/2080/events",
  "html_url": "https://github.com/alibaba/weex/pull/2080",
  "id": 197974379,
  "number": 2080,
  "title": "+ [ios] feature: follow w3c standard.  weex provide  websocket  module",
  "user": {
    "login": "kfeagle",
    "id": 11485145,
    "avatar_url": "https://avatars0.githubusercontent.com/u/11485145?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kfeagle",
    "html_url": "https://github.com/kfeagle",
    "followers_url": "https://api.github.com/users/kfeagle/followers",
    "following_url": "https://api.github.com/users/kfeagle/following{/other_user}",
    "gists_url": "https://api.github.com/users/kfeagle/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kfeagle/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kfeagle/subscriptions",
    "organizations_url": "https://api.github.com/users/kfeagle/orgs",
    "repos_url": "https://api.github.com/users/kfeagle/repos",
    "events_url": "https://api.github.com/users/kfeagle/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kfeagle/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "bluebird78999",
    "id": 753735,
    "avatar_url": "https://avatars1.githubusercontent.com/u/753735?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bluebird78999",
    "html_url": "https://github.com/bluebird78999",
    "followers_url": "https://api.github.com/users/bluebird78999/followers",
    "following_url": "https://api.github.com/users/bluebird78999/following{/other_user}",
    "gists_url": "https://api.github.com/users/bluebird78999/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bluebird78999/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bluebird78999/subscriptions",
    "organizations_url": "https://api.github.com/users/bluebird78999/orgs",
    "repos_url": "https://api.github.com/users/bluebird78999/repos",
    "events_url": "https://api.github.com/users/bluebird78999/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bluebird78999/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "bluebird78999",
      "id": 753735,
      "avatar_url": "https://avatars1.githubusercontent.com/u/753735?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bluebird78999",
      "html_url": "https://github.com/bluebird78999",
      "followers_url": "https://api.github.com/users/bluebird78999/followers",
      "following_url": "https://api.github.com/users/bluebird78999/following{/other_user}",
      "gists_url": "https://api.github.com/users/bluebird78999/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bluebird78999/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bluebird78999/subscriptions",
      "organizations_url": "https://api.github.com/users/bluebird78999/orgs",
      "repos_url": "https://api.github.com/users/bluebird78999/repos",
      "events_url": "https://api.github.com/users/bluebird78999/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bluebird78999/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "cxfeng1",
      "id": 1625893,
      "avatar_url": "https://avatars2.githubusercontent.com/u/1625893?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cxfeng1",
      "html_url": "https://github.com/cxfeng1",
      "followers_url": "https://api.github.com/users/cxfeng1/followers",
      "following_url": "https://api.github.com/users/cxfeng1/following{/other_user}",
      "gists_url": "https://api.github.com/users/cxfeng1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cxfeng1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cxfeng1/subscriptions",
      "organizations_url": "https://api.github.com/users/cxfeng1/orgs",
      "repos_url": "https://api.github.com/users/cxfeng1/repos",
      "events_url": "https://api.github.com/users/cxfeng1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cxfeng1/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "acton393",
      "id": 11631084,
      "avatar_url": "https://avatars1.githubusercontent.com/u/11631084?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/acton393",
      "html_url": "https://github.com/acton393",
      "followers_url": "https://api.github.com/users/acton393/followers",
      "following_url": "https://api.github.com/users/acton393/following{/other_user}",
      "gists_url": "https://api.github.com/users/acton393/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/acton393/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/acton393/subscriptions",
      "organizations_url": "https://api.github.com/users/acton393/orgs",
      "repos_url": "https://api.github.com/users/acton393/repos",
      "events_url": "https://api.github.com/users/acton393/events{/privacy}",
      "received_events_url": "https://api.github.com/users/acton393/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "boboning",
      "id": 18302124,
      "avatar_url": "https://avatars0.githubusercontent.com/u/18302124?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/boboning",
      "html_url": "https://github.com/boboning",
      "followers_url": "https://api.github.com/users/boboning/followers",
      "following_url": "https://api.github.com/users/boboning/following{/other_user}",
      "gists_url": "https://api.github.com/users/boboning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/boboning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/boboning/subscriptions",
      "organizations_url": "https://api.github.com/users/boboning/orgs",
      "repos_url": "https://api.github.com/users/boboning/repos",
      "events_url": "https://api.github.com/users/boboning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/boboning/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": [],
  "created_at": "2016-12-29T08:56:06Z",
  "updated_at": "2016-12-30T03:46:15Z",
  "closed_at": "2016-12-30T03:46:15Z",
  "pull_request": {
    "url": "https://api.github.com/repos/alibaba/weex/pulls/2080",
    "html_url": "https://github.com/alibaba/weex/pull/2080",
    "diff_url": "https://github.com/alibaba/weex/pull/2080.diff",
    "patch_url": "https://github.com/alibaba/weex/pull/2080.patch"
  },
  "body": "#### websocket [参考](https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket)\r\n* 名字\r\n  - websocket\r\n* 描述\r\n  - websocket在聊天应用，小游戏中会用到，建议加上基础功能websokcet，实现后，可以用于应用的交互场景，websocket已经是大多数程序的必备功能\r\n* 平台\r\n  - ios,android,H5\r\n* 类型\r\n  - module\r\n* 解决方案\r\n  - weex 提供websocket，h5 直接用原生的websocket，安卓和ios根据w3c的websocket接口实现对应的接口，需要更改jsfm，jsfm重写方法设置功能， 支持方法的赋值功能，这样jsfm赋值的函数可以监听module的api，从而实现严格按照w3c标准的api\r\n  - weex提供默认的protocol实现，用户也可以实现自己的protocol，增强websocket功能\r\n  - 对于websocket的实例，可以参考stream的实现，根据协议的名字设置（隐风建议一个instance 一个实例）\r\n* api\r\n  - WebSocket(\r\n     string url,\r\n     string option protocol\r\n );\r\n     - url：需要连接的URL(string)\r\n     - protocol: 协议(string)\r\n  - send(string data)\r\n     - data：发送到服务器的数据(string)\r\n - close(int code,string reason)\r\n     - code：表示关闭连接的状态号，默认值1000(表示正常连接关闭)(int)\r\n     - reason:可选，表示关闭的原因(string)\r\n - onerror(e)\r\n     - 当错误发生时用于监听error事件的事件监听器。会接受一个名为error的event对象(dictionary)\r\n         - data(string)：错误数据\r\n - onmessage(e)\r\n     - 一个用于消息事件的事件监听器，这一事件当有消息到达的时候该事件会触发。这个Listener会被传入一个名为\"message\"的MessageEvent对象(dictionary)。\r\n         - data(string)：Returns a DOMString, Blob or an ArrayBuffer containing the data send by the emitter,目前支持字符串\r\n - onopen(e)\r\n     - 一个用于连接打开事件的事件监听器。当readyState的值变为OPEN的时候会触发该事件。该事件表明这个连接已经准备好接受和发送数据。这个监听器会接受一个名为\"open\"的事件对象。(dictionary)\r\n         - type(string):默认值\"open\"\r\n - onclose(e)\r\n     - (dictionary)用于监听连接关闭事件监听器。当WebSocket对象的readyState状态变为CLOSED时会触发该事件。这个监听器会接收一个叫close的对象。\r\n         - code(number):返回一个 unsigned short 类型的数字, 表示服务端发送的关闭码\r\n         - reason(string):用以表示服务器关闭连接的原因. 这是由服务器和子协议决定的\r\n         - wasClean:(bool):用以表示连接是否完全关闭\r\n -  备注\r\n     - 增加监听：可以墨循想到实现方案，早弦在jsfm 实现了相关功能，方法的代理\r\n\r\n     - 使用例子\r\n\r\n     ```javascript\r\n     connect:function(e) {\r\n                websocket.WebSocket('ws://115.29.193.48:8088','');\r\n                var self = this;\r\n                websocket.onopen = function(e)\r\n                {\r\n                    self.onopeninfo = e;\r\n                }\r\n                websocket.onmessage = function(e)\r\n                {\r\n                    self.onmessage = e.data;\r\n                }\r\n                websocket.onerror = function(e)\r\n                {\r\n                    self.onerrorinfo = e.data;\r\n                }\r\n                websocket.onclose = function(e)\r\n                {\r\n                    self.onerrorinfo = e.reason;\r\n                }\r\n            },\r\n            send:function(e) {\r\n                var input = this.$el('input');\r\n                input.blur();\r\n                websocket.send(this.txtInput);\r\n                this.sendinfo = this.txtInput;\r\n\r\n            },\r\n     ```\r\n"
}
