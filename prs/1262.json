{
  "url": "https://api.github.com/repos/alibaba/weex/issues/1262",
  "repository_url": "https://api.github.com/repos/alibaba/weex",
  "labels_url": "https://api.github.com/repos/alibaba/weex/issues/1262/labels{/name}",
  "comments_url": "https://api.github.com/repos/alibaba/weex/issues/1262/comments",
  "events_url": "https://api.github.com/repos/alibaba/weex/issues/1262/events",
  "html_url": "https://github.com/alibaba/weex/pull/1262",
  "id": 178007181,
  "number": 1262,
  "title": "* [ios] fix #1188, support for converting string to NSUInteger.",
  "user": {
    "login": "namedlock",
    "id": 3077786,
    "avatar_url": "https://avatars2.githubusercontent.com/u/3077786?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/namedlock",
    "html_url": "https://github.com/namedlock",
    "followers_url": "https://api.github.com/users/namedlock/followers",
    "following_url": "https://api.github.com/users/namedlock/following{/other_user}",
    "gists_url": "https://api.github.com/users/namedlock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/namedlock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/namedlock/subscriptions",
    "organizations_url": "https://api.github.com/users/namedlock/orgs",
    "repos_url": "https://api.github.com/users/namedlock/repos",
    "events_url": "https://api.github.com/users/namedlock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/namedlock/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": [
    {
      "url": "https://api.github.com/repos/alibaba/weex/issues/comments/248503853",
      "html_url": "https://github.com/alibaba/weex/pull/1262#issuecomment-248503853",
      "issue_url": "https://api.github.com/repos/alibaba/weex/issues/1262",
      "id": 248503853,
      "user": {
        "login": "CLAassistant",
        "id": 11571300,
        "avatar_url": "https://avatars2.githubusercontent.com/u/11571300?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/CLAassistant",
        "html_url": "https://github.com/CLAassistant",
        "followers_url": "https://api.github.com/users/CLAassistant/followers",
        "following_url": "https://api.github.com/users/CLAassistant/following{/other_user}",
        "gists_url": "https://api.github.com/users/CLAassistant/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/CLAassistant/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/CLAassistant/subscriptions",
        "organizations_url": "https://api.github.com/users/CLAassistant/orgs",
        "repos_url": "https://api.github.com/users/CLAassistant/repos",
        "events_url": "https://api.github.com/users/CLAassistant/events{/privacy}",
        "received_events_url": "https://api.github.com/users/CLAassistant/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-09-21T03:46:20Z",
      "updated_at": "2016-09-21T07:49:36Z",
      "body": "[![CLA assistant check](https://cla-assistant.io/pull/badge/signed)](https://cla-assistant.io/alibaba/weex?pullRequest=1262) <br/>All committers have signed the CLA.\n"
    }
  ],
  "created_at": "2016-09-20T09:13:54Z",
  "updated_at": "2016-09-21T11:39:03Z",
  "closed_at": "2016-09-21T11:39:03Z",
  "pull_request": {
    "url": "https://api.github.com/repos/alibaba/weex/pulls/1262",
    "html_url": "https://github.com/alibaba/weex/pull/1262",
    "diff_url": "https://github.com/alibaba/weex/pull/1262.diff",
    "patch_url": "https://github.com/alibaba/weex/pull/1262.patch"
  },
  "body": "### 问题所在\n\ntext的lines属性值的转换由WXConvert负责，且对应到方法\n\n```\nWXConvert:NSUInteger:\n```\n\n而该方法是由宏定义生成的，该宏定义的代码如下：\n\n```\n#define WX_NUMBER_CONVERT(type, op) \\\n+ (type)type:(id)value {\\\n    if([value respondsToSelector:@selector(op)]){\\\n        return (type)[value op];\\\n    } else {\\\n        WXLogError(@\"Convert Error:%@ not respond selector:%@\", value, @#op);\\\n    }\\\n    return 0;\\\n}\n```\n- 当text的lines属性值设置为string时，WXConvert的相关转换方法的入参为string类型，无法响应以下中unsigned开头的方法。\n- 当text的lines属性值设置为数值类型时，WXConvert的相关转换方法的入参为Number类型，可以响应以下中unsigned开头的方法。\n\n```\nWX_NUMBER_CONVERT(BOOL, boolValue)\nWX_NUMBER_CONVERT(int, intValue)\nWX_NUMBER_CONVERT(short, shortValue)\nWX_NUMBER_CONVERT(int64_t, longLongValue)\nWX_NUMBER_CONVERT(uint8_t, unsignedShortValue)\nWX_NUMBER_CONVERT(uint16_t, unsignedIntValue)\nWX_NUMBER_CONVERT(uint32_t, unsignedLongValue)\nWX_NUMBER_CONVERT(uint64_t, unsignedLongLongValue)\nWX_NUMBER_CONVERT(float, floatValue)\nWX_NUMBER_CONVERT(double, doubleValue)\nWX_NUMBER_CONVERT(NSInteger, integerValue)\nWX_NUMBER_CONVERT(NSUInteger, unsignedIntegerValue)\n```\n### 修改方式\n\n在宏定义的else分支中，增加string类型的转换逻辑。\n\n```\n#define WX_NUMBER_CONVERT(type, op) \\\n+ (type)type:(id)value {\\\n    if([value respondsToSelector:@selector(op)]){\\\n        return (type)[value op];\\\n    } else {\\\n        NSString * strval = [NSString stringWithFormat:@\"%@\",value];\\\n        return (type)[self uint64_t: strval];\\\n    }\\\n}\n```\n\n上述代码逻辑解释为，直接将入参格式化为string，然后转换为uint64_t类型，再强制转换为比uint64_t位数更少的类型。\n\n```\n//unsignedLongLongValue\n+ (uint64_t)uint64_t:(id)value {\\\n    NSString * strval = [NSString stringWithFormat:@\"%@\",value];\n    unsigned long long ullvalue = strtoull([strval UTF8String], NULL, 10);\n    return ullvalue;\n}\n```\n### 结语：\n- 以上代码修改不会对现有代码造成影响，只会增加对string类型转换的支持。\n- 以上代码的string转换功能，已经通过Demo中的Text元素lines属性的设置，自测通过。\n- SDK工程中增加了WXConvertTests类，测试了以下方法。（其他方法为私有方法，未测试）\n\n```\n- (void)testBOOL\n- (void) testNSUInteger\n```\n\n附测试的we代码：\n\n```\n<template>\n    <div class=\"ct\" style=\"height: {{ctHeight}}\">\n        <image class=\"img\" style=\"width: 400; height: 400;\" src=\"{{img}}\"></image>\n        <text style=\"font-size: 42; lines:{{lines}};\">\n            1Hello Weex! i'm weex.lines 作为字符串类型从 JavaScript 传递给 iOS 客户端的时候无法被识别 2Hello Weex! i'm weex.lines 作为字符串类型从 JavaScript 传递给 iOS 客户端的时候无法被识别 3Hello Weex! i'm weex.lines 作为字符串类型从 JavaScript 传递给 iOS 客户端的时候无法被识别 4Hello Weex! i'm weex.lines 作为字符串类型从\n            JavaScript 传递给 iOS 客户端的时候无法被识别 5Hello Weex! i'm weex.lines 作为字符串类型从 JavaScript 传递给 iOS 客户端的时候无法被识别</text>\n    </div>\n</template>\n<style>\n    .wrapper {\n        align-items: center;\n        margin-top: 120;\n    }\n    .title {\n        font-size: 48;\n    }\n    .img {\n        width: 360;\n        height: 82;\n    }\n\n</style>\n<script>\n    module.exports = {\n        data: {\n            lines: 5,\n            ctHeight: 200,\n            img: '//gw.alicdn.com/tps/i2/TB1DpsmMpXXXXabaXXX20ySQVXX-512-512.png_400x400.jpg'\n        },\n        ready: function () {\n            this.ctHeight = this.$getConfig().env.deviceHeight\n        }\n    }\n</script>\n\n```\n",
  "closed_by": {
    "login": "cxfeng1",
    "id": 1625893,
    "avatar_url": "https://avatars2.githubusercontent.com/u/1625893?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cxfeng1",
    "html_url": "https://github.com/cxfeng1",
    "followers_url": "https://api.github.com/users/cxfeng1/followers",
    "following_url": "https://api.github.com/users/cxfeng1/following{/other_user}",
    "gists_url": "https://api.github.com/users/cxfeng1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cxfeng1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cxfeng1/subscriptions",
    "organizations_url": "https://api.github.com/users/cxfeng1/orgs",
    "repos_url": "https://api.github.com/users/cxfeng1/repos",
    "events_url": "https://api.github.com/users/cxfeng1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cxfeng1/received_events",
    "type": "User",
    "site_admin": false
  }
}
